<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Un blog qui parle de châtons, de code, enfin de la vie quoi !">

    <title>Python et Mandelbrot - poulpiBlog</title>

    <link rel="canonical" href="http://poulpi.fr/2013/06/27/python-et-mandelbrot/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom styles -->
    <link rel="stylesheet" href="/css/custom.css">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- mathjax config similar to math.stackexchange -->

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          processEscapes: true
        }
      });
    </script>

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
          }
        });
    </script>

    <script type="text/x-mathjax-config">
        MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

    <script type="text/javascript"
       src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">poulpiBlog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
                <li>
                    <a href="/about/">A propos</a>
                </li>
                
                <li>
                    <a href="/contact/">Contact</a>
                </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/python.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Python et Mandelbrot</h1>
                    
                    <span class="meta">Posté par poulpi le 27/06/13</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<p><strong>Disclaimer : Ce billet sera geek. Voilà ça va parler de programmation (pas trop quand même) et de jolies formes 
(on se rapproche de mon élément :p). Je préfère prévenir =)</strong></p>

<h2 id="une-belle-rencontre">Une belle rencontre</h2>

<p>Il y a peu, on m’a demandé de rajouter une nouvelle fonction dans l’outil que je réalise dans mon stage. il s’agit 
d’une reconnaissance de feuille de papier dans une photo prise par un smartphone puis redimensionnement et “correction”
 de la dite feuille. Le tout en embarqué.</p>

<p>Le quidam moyen qui a déjà un peu joué avec ce genre de choses sais qu’il ne faut pas chercher midi à quatorze heure 
et tout est faisable en quelques lignes bien pensées avec <a href="http://opencv.org">OpenCV</a> qui dispose d’ailleurs d’une version android, le rêve.</p>

<p>Je ne m’étendrai pas sur cette bibliothèque mais en résumé elle est faite pour les gens qui n’ont pas envie de passer 
leur vie à compulser les 2000 articles scientifiques qui dissertent de la meilleure façon de traiter une image. OpenCV 
c’est un truc de mecs qui veulent que ça fonctionne sans se prendre la tête. Period. Mais c’est aussi une librairie poilue en C++. Et ça c’est pas cool.</p>

<p>Parce que faire joujou avec sa webcam c’est sympa. Mais quand il s’agit de le faire avec un programme codé (et compilé) 
en C++, faut se retrousser les manches. Et ça peut prendre la nuit pour juste arriver à faire dire “Pouet” à son écran.
 Par conséquent j’ai pas envie de prototyper avec ça. Mais OpenCV a pensé à nous autres codeurs glandu, 
 il y a un wrapper Python #top#</p>

<p>C’est comme ça que j’ai rencontré <a href="http://fr.wikipedia.org/wiki/Python_\(langage\)">Python</a>. Comme toute les choses 
merveilleuses, ce langage est apparu au début des années 90. Et il est sexy #love#</p>

<h2 id="un-truc-pour-les-gens-qui-aiment-garder-les-chose-simples-sans-sacrifier-la-puissance">Un truc pour les gens qui aiment garder les chose simples (sans sacrifier la puissance)</h2>

<p>Python c’est un langage qui a tout ce qui faut à un langage de “sexy codeur” © : il est élégant, possède la notion d’objet, 
permet de faire de grande chose facilement et dispose d’une grande communauté avec plein de librairies trop stylées.</p>

<p>C’est aussi un langage sans typage fort. Ça veut dire que les variables ne te cassent pas les couilles à te demander sans 
cesse de définir qui elles sont, quelle place elles doivent prendre en mémoire, etc. Par exemple en C pour faire un tableau
 d’entier c’est relativement emmerdant. En Python tu mets un tableau dans une variable et elle encaisse. Si deux ligne plus
 tard tu préfères mettre une chaîne de caractère, elle va se transformer pour te permettre de le faire. En C j’en parle même 
 pas, c’est limite si ton PC ne t’insulte pas.</p>

<p>Après quelques recherches le langage a l’air assez populaire pour les scientifiques qui veulent des gros programmes sans se 
briser les neurones (ou toute autre organe de forme sphérique) à le faire en MATLAB : Python est plus souple, plus facilement 
optimisable, beaucoup plus gratuit :p et surtout c’est plus facile de s’y retrouver dès qu’on fait des gros programmes.</p>

<h2 id="cest-l-o-on-passe-aux-jolies-formes">C’est là où on passe aux jolies formes</h2>

<p>Quand je commence un langage j’aime bien coder un truc qui sert à rien. Quand j’ai commencé le C sur ma TI-92 au lycée, j’avais 
fait un programme qui dessinait <a href="http://fr.wikipedia.org/wiki/Ensemble_de_Mandelbrot">l’ensemble de Mandelbrot</a>. J’ai réitéré.</p>

<p>Voilà donc je vous offre quelques images avec des jolies couleurs que mon PC il a fait tout seul. Et je vous donne le code python 
aussi. Vous allez voir, c’est pas sorcier. Enfin je connais des gens qui simulent des ballons de rugby avec des triples boucles 
imbriquées en MATLAB, moi je reste au O(n²) :p (une image comme ça prends quand même 20 secondes sur ma bécane …)</p>

<p class="center"><img src="/img/mandel1.png" alt="Le paté le plus connu de l'histoire" /></p>

<p class="center"><img src="/img/mandel2.png" alt="Voilà je zoome. J'ose." /> </p>

<p class="center"><img src="/img/mandel3.png" alt="Les détails c'est important !" /></p>

<p>Et le code maintenant. J’ai une classe qui calcule une matrice qui représente l’ensemble et un fichier qui l’affiche.</p>

<p>Le code de génération :</p>

<pre><code>import numpy as np
import sys

def frange(start, stop, step=1.0):
    while start &lt; stop:
        yield start
        start += step
        
class mandelbrot:

    def __init__(self, rect, w, h, max_iteration):
        self.grid = np.zeros((w, h))
        self.max_iteration = max_iteration
        self.rect = rect
        self.w = w
        self.h = h
        
    def compute(self):

        w = 0
        
        for i in frange(self.rect.left, self.rect.right, float((self.rect.right - self.rect.left)/float(self.w))):

            h = self.h - 1
            
            for j in frange(self.rect.bottom, self.rect.top, float((self.rect.top - self.rect.bottom)/float(self.h))):
                
                c = complex(i, j)
                z = complex(0,0)
                t = 0
                
                while (abs(z) &lt; 2 and t &lt; self.max_iteration):
                    z = z * z + c
                    t = t + 1
                    
                if w &gt;= self.w:
                    print 'Out of bound : w'
                    continue

                if h &gt;= self.h:
                    print 'Out of bound : h'
                    continue
                
                if(abs(z) &gt;= 2):
                    self.grid[w, h] = t
                    #print 'z : ' + repr(z.norm()) + ' t : ' + repr(t) + ' zx : ' + repr(z.x) + ' zy : ' + repr(z.y)
                else:
                    self.grid[w, h] = -1

                #print '  i / j | h= ' + repr(i) + ' ' + repr(j) + ' ' + repr(h)
                h = h - 1
                
            if w % 10 == 0:
                print 'w = ' + repr(w)
                
            w = w + 1
    
        return self.grid;                           
</code></pre>

<p>Comment afficher la matrice :</p>

<pre><code>import sys
import pygame

import Mandelbrot

class rectangle:
   def __init__(self, bottom, top, left, right):
      self.right = right
      self.left = left
      self.top = top
      self.bottom = bottom
      
def draw(N):
   w = N.shape[0]
   h = N.shape[1]
   
   pygame.init() 

   #create the screen
   window = pygame.display.set_mode((w, h)) 

   # Fill background
   background = pygame.Surface(window.get_size())
   background = background.convert()
   background.fill((250, 250, 250))

   for i in range(w):
      for j in range(h):
         if N[i, j] != -1:
            t = N[i, j]
            ## C'est là qu'on tweake les couleurs ! (là c'est fait à la zob mais en vrai faudrait prendre
            ##les valeurs max de la matrice pour faire un joli dégradé)
            background.set_at((i, h - j), ((t*32)%255, (t*16)%255, (t*4)%255))

   #save the image to file
   pygame.image.save(background, 'mandel.png')

   #draw it to the screen
   window.blit(background, (0, 0))
   
   pygame.display.flip()

   #input handling (somewhat boilerplate code):
   while True: 
      for event in pygame.event.get(): 
         if event.type == pygame.QUIT: 
             sys.exit(0) 
         else: 
             print event 
      
## C'est là où on paramètre les intervalles qu'on veut afficher
ymin = -1
ymax = 1
xmin = -2
xmax = 0.5

largeur = 800
iteration = 300

ratio = float(ymax - ymin) / float(xmax - xmin)
rect = rectangle(ymin, ymax, xmin, xmax)

w = int(largeur)
h = int(ratio * largeur)

M = Mandelbrot.mandelbrot(rect, w, h, iteration)
N = M.compute()

draw(N)
</code></pre>

<p>Pour infos j’utilise la super librairie <a href="http://www.pygame.org/">PyGame</a> pour l’affichage et <a href="http://www.numpy.org/">Numpy</a> pour faire ma matrice.</p>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2013/06/23/google-trends/" data-toggle="tooltip" data-placement="top" title="Google Trends">&larr; Billet précédent</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2013/07/02/python-et-mandelbrot-part-II/" data-toggle="tooltip" data-placement="top" title="Mandelbrot et Python : Part II (Optimisation)">Billet suivant &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>

    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/PoulpiP">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/synchrocomptes">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/PoulpiFr">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; poulpiBlog 2015</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
